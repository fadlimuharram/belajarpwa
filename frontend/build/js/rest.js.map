{"version":3,"sources":["dbhelper.js","idb.js","restaurant_info.js"],"names":["DBHelper","idb","open","upgradeDB","oldVersion","createObjectStore","keyPath","createIndex","callback","_this","this","dbPromise","then","db","transaction","objectStore","getAll","restaurants","length","fetch","DATABASE_URL","response","json","restStore","forEach","restaurant","put","catch","error","console","log","id","_this2","reviews","revStore","Array","isArray","review","getDbObjectByID","navigator","onLine","reviewOfflineCounter","key","localStorage","hasOwnProperty","startsWith","setItem","JSON","stringify","sendDataWhenOnline","method","body","headers","Headers","Content-Type","contentType","get","indexOf","table","index","fav","favOffline","restaurant_id","is_favorite","updateFavInDB","pushDataFromLocalStorage","window","addEventListener","parse","updateFav","removeItem","concat","_toConsumableArray","document","querySelectorAll","element","remove","reviewOffline","sendReview","fetchRestaurants","find","r","Error","cuisine","results","filter","cuisine_type","neighborhood","neighborhoods","map","v","i","uniqueNeighborhoods","cuisines","uniqueCuisines","photograph","icon","L","iconUrl","shadowUrl","marker","Marker","latlng","lat","lng","title","name","alt","url","urlForRestaurant","addTo","myMap","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","promisifyRequestCall","obj","args","p","apply","proxyProperties","ProxyClass","targetProp","properties","prop","Object","defineProperty","prototype","set","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","value","Cursor","Index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","complete","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","arr","slice","call","nativeObject","query","count","instance","items","iterateCursor","push","undefined","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded","event","delete","module","exports","default","self","e","initMap","fetchRestaurantFromURL","center","zoom","tileLayer","attribution","maxZoom","accessToken","scrollWheelZoom","disable","fillBreadcrumb","mapMarkerForRestaurant","getParameterByName","fetchRestaurantById","fillRestaurantHTML","getElementById","innerHTML","address","image","className","src","picture","media","srcset","operating_hours","fillRestaurantHoursHTML","fetchReviews","operatingHours","hours","row","createElement","day","appendChild","time","fetchReviewsById","fillReviewsHTML","addReview","preventDefault","rating","querySelector","comments","reviewData","style","borderColor","parseInt","test","createdAt","Date","valueOf","keys","reset","container","ul","createReviewHTML","tabIndex","noReviews","reviewLocal","getItem","offline","li","date","stars","repeat","breadcrumb","home","link","href","location","RegExp","exec","decodeURIComponent"],"mappings":"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","file":"rest.js","sourcesContent":["'use strict';\r\n\r\n/**\r\n * Common database helper functions.\r\n */\r\nclass DBHelper {\r\n  /**\r\n   * Database URL.\r\n   * Change this to restaurants.json file location on your server.\r\n   */\r\n  static get DATABASE_URL() {\r\n    const port = 1337; // Change this to your server port\r\n    return `http://localhost:${port}/`;\r\n  }\r\n\r\n  static dbPromise() {\r\n    return idb.open('db', 1, upgradeDB => {\r\n      switch (upgradeDB.oldVersion) {\r\n      case 0:\r\n        upgradeDB.createObjectStore('restaurants', {keyPath: 'id'});\r\n        break;\r\n      case 1:\r\n        const reviewsStore = upgradeDB.createObjectStore('reviews', {keyPath: 'id'});\r\n        reviewsStore.createIndex('byRestaurantId', 'restaurant_id');\r\n        break;\r\n      }\r\n    });\r\n  }\r\n\r\n  static fetchRestaurants(callback) {\r\n    return this.dbPromise()\r\n      .then(db => {\r\n        let tx = db.transaction('restaurants');\r\n        const store = tx.objectStore('restaurants');\r\n        return store.getAll();\r\n      })\r\n      .then(restaurants => {\r\n        if (restaurants.length !== 0) {\r\n          return callback(null, restaurants);\r\n        }\r\n        fetch(`${DBHelper.DATABASE_URL}restaurants`)\r\n          .then(response => response.json())\r\n          .then(restaurants => {\r\n            this.dbPromise()\r\n              .then(db => {\r\n                if (!db) return db;\r\n\r\n                let tx = db.transaction('restaurants', 'readwrite');\r\n                const restStore = tx.objectStore('restaurants');\r\n\r\n                restaurants.forEach(restaurant => restStore.put(restaurant));\r\n\r\n                return callback(null, restaurants);\r\n              });\r\n          })\r\n          .catch(error => {\r\n            console.log('Restaurants fetch error: ' + error);\r\n          });\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Fetch a Reviews by Restaurant ID.\r\n   */\r\n  static fetchReviewsById(id, callback) {\r\n    fetch(`${DBHelper.DATABASE_URL}reviews/?restaurant_id=${id}`)\r\n      .then(response => response.json())\r\n      .then(reviews => {\r\n        this.dbPromise()\r\n          .then(db => {\r\n            if (!db) return;\r\n\r\n            let tx = db.transaction('reviews', 'readwrite');\r\n            const revStore = tx.objectStore('reviews');\r\n\r\n            if (Array.isArray(reviews)) {\r\n              reviews.forEach(review => revStore.put(review));\r\n            } else {\r\n              revStore.put(reviews);\r\n            }\r\n          });\r\n        return callback(null, reviews);\r\n      })\r\n      .catch(error => {\r\n        console.log('Review fetch by ID error: ' + error);\r\n        return DBHelper.getDbObjectByID('reviews', 'byRestaurantId', id)\r\n          .then(reviews => {\r\n            return callback(null, reviews);\r\n          });\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Send Review\r\n   */\r\n  static sendReview(review) {\r\n    if (!navigator.onLine) {\r\n      // count offline reviews in localstorage\r\n      let reviewOfflineCounter = 1;\r\n      for (var key in localStorage) {\r\n        if (localStorage.hasOwnProperty(key)) {\r\n          if (localStorage[key] !== null && key.startsWith('reviewOffline')) {\r\n            reviewOfflineCounter++;\r\n          }\r\n        }\r\n      }\r\n\r\n      // add review to localstorage and add eventlistner to send when online\r\n      localStorage.setItem('reviewOffline' + reviewOfflineCounter, JSON.stringify(review));\r\n      console.log('Offline, review saved local and will sync later');\r\n      DBHelper.sendDataWhenOnline();\r\n      return;\r\n    }\r\n\r\n    fetch(`${DBHelper.DATABASE_URL}reviews`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(review),\r\n      headers: new Headers({'Content-Type': 'application/json'})\r\n    }).then((response) => {\r\n      const contentType = response.headers.get('content-type');\r\n      if (contentType && contentType.indexOf('application/json') !== -1) {\r\n        return response.json();\r\n      } else {\r\n        return 'Success';\r\n      }\r\n    }).catch(error => console.log('Review fetch error: ' + error));\r\n  }\r\n\r\n  /**\r\n   * Get object from IndexedDB by ID\r\n   */\r\n  static getDbObjectByID(table, index, id) {\r\n    return this.dbPromise().then(db => {\r\n      if (!db) return;\r\n\r\n      const store = db.transaction(table).objectStore(table);\r\n      const indexId = store.index(index);\r\n\r\n      return indexId.getAll(id);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update Favorite by ID\r\n   */\r\n  static updateFav(id, fav) {\r\n    if (!navigator.onLine) {\r\n      let favOffline = {\r\n        restaurant_id: id,\r\n        is_favorite: fav\r\n      };\r\n\r\n      localStorage.setItem('favoriteOffline' + id, JSON.stringify(favOffline));\r\n      console.log('Offline, restaurant ' + id + ' favorite status updated and will sync later');\r\n      DBHelper.sendDataWhenOnline();\r\n      DBHelper.updateFavInDB(id, fav);\r\n      return;\r\n    }\r\n\r\n    fetch(`${DBHelper.DATABASE_URL}restaurants/${id}/?is_favorite=${fav}`, {\r\n      method: 'PUT'\r\n    }).then(() => {\r\n      DBHelper.updateFavInDB(id, fav);\r\n    }).catch(error => console.log('Favorite fetch error: ' + error));\r\n  }\r\n\r\n  /**\r\n   * Change favorite status in IndexedDB\r\n   */\r\n  static updateFavInDB(id, fav) {\r\n    this.dbPromise().then(db => {\r\n      if (!db) return;\r\n\r\n      let tx = db.transaction('restaurants', 'readwrite');\r\n      const restStore = tx.objectStore('restaurants');\r\n\r\n      restStore.get(id)\r\n        .then(restaurant => {\r\n          restaurant.is_favorite = fav;\r\n          restStore.put(restaurant);\r\n        });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Eventlistner for Online status\r\n   */\r\n  static sendDataWhenOnline() {\r\n    if (navigator.onLine) {\r\n      DBHelper.pushDataFromLocalStorage();\r\n    } else {\r\n      window.addEventListener('online', () => {\r\n        DBHelper.pushDataFromLocalStorage();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pushing favorite status and sending reviews\r\n   */\r\n  static pushDataFromLocalStorage() {\r\n    // loop through localstorage items\r\n    for (var key in localStorage) {\r\n      if (localStorage.hasOwnProperty(key)) {\r\n        // update favorites\r\n        if (localStorage[key] !== null && key.startsWith('favoriteOffline')) {\r\n          // get favorite from localstorage\r\n          let favOffline = JSON.parse(localStorage[key]);\r\n\r\n          // send it to backend and remove\r\n          DBHelper.updateFav(favOffline.restaurant_id, favOffline.is_favorite);\r\n          localStorage.removeItem(key);\r\n          console.log('Online, favorite for restaurant ' + favOffline.restaurant_id + ' updated');\r\n        }\r\n\r\n        // update reviews\r\n        if (localStorage[key] !== null && key.startsWith('reviewOffline')) {\r\n          // remove offline indicator\r\n          [...document.querySelectorAll('.reviews-offline')].forEach(element => {\r\n            element.remove();\r\n          });\r\n\r\n          // get review from localstorage\r\n          let reviewOffline = JSON.parse(localStorage[key]);\r\n\r\n          // send it to backend and remove\r\n          DBHelper.sendReview(reviewOffline);\r\n          localStorage.removeItem(key);\r\n          console.log('Online, review sent');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch a restaurant by its ID.\r\n   */\r\n  static fetchRestaurantById(id, callback) {\r\n    // fetch all restaurants with proper error handling.\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        const restaurant = restaurants.find(r => r.id == id);\r\n        if (restaurant) {\r\n          // Got the restaurant\r\n          callback(null, restaurant);\r\n        } else {\r\n          // Restaurant does not exist in the database\r\n          callback(new Error('Restaurant does not exist'), null);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine type with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisine(cuisine, callback) {\r\n    // Fetch all restaurants  with proper error handling\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given cuisine type\r\n        const results = restaurants.filter(r => r.cuisine_type === cuisine);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByNeighborhood(neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given neighborhood\r\n        const results = restaurants.filter(r => r.neighborhood === neighborhood);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        let results = restaurants;\r\n        if (cuisine !== 'all') { // filter by cuisine\r\n          results = results.filter(r => r.cuisine_type === cuisine);\r\n        }\r\n        if (neighborhood !== 'all') { // filter by neighborhood\r\n          results = results.filter(r => r.neighborhood === neighborhood);\r\n        }\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all neighborhoods with proper error handling.\r\n   */\r\n  static fetchNeighborhoods(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all neighborhoods from all restaurants\r\n        const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood);\r\n        // Remove duplicates from neighborhoods\r\n        const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) === i);\r\n        callback(null, uniqueNeighborhoods);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all cuisines with proper error handling.\r\n   */\r\n  static fetchCuisines(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all cuisines from all restaurants\r\n        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type);\r\n        // Remove duplicates from cuisines\r\n        const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) === i);\r\n        callback(null, uniqueCuisines);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Restaurant page URL.\r\n   */\r\n  static urlForRestaurant(restaurant) {\r\n    return (`./restaurant.html?id=${restaurant.id}`);\r\n  }\r\n\r\n  /**\r\n   * Restaurant image URL.\r\n   */\r\n  static imageUrlForRestaurant(restaurant) {\r\n    return (`/img/${restaurant.photograph}.jpg`);\r\n  }\r\n\r\n  /**\r\n   * Map marker for a restaurant.\r\n   */\r\n  static mapMarkerForRestaurant(restaurant) {\r\n    let icon = L.icon({\r\n      iconUrl: 'img/icons/marker-icon.png',\r\n      shadowUrl: 'img/icons/marker-shadow.png'\r\n    });\r\n\r\n    const marker = new L.Marker([restaurant.latlng.lat, restaurant.latlng.lng], {\r\n      title: restaurant.name,\r\n      alt: restaurant.name,\r\n      icon: icon,\r\n      url: DBHelper.urlForRestaurant(restaurant)\r\n    });\r\n\r\n    marker.addTo(myMap);\r\n    return marker;\r\n  }\r\n}\r\n","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  } else {\n    self.idb = exp;\n  }\n}());\n","'use strict';\n\nlet restaurant;\n\ndocument.addEventListener('DOMContentLoaded', (e) => {\n  initMap();\n\n  // if localstorage not empty add eventlistner to send data when online\n  if (localStorage.length !== 0) DBHelper.sendDataWhenOnline();\n});\n\n/**\n * Initialize Leaflet map\n */\nvar initMap = () => {\n  fetchRestaurantFromURL((error, restaurant) => {\n    if (error) { // Got an error!\n      console.error(error);\n    } else {\n      self.myMap = L.map('map', {\n        center: [restaurant.latlng.lat, restaurant.latlng.lng],\n        zoom: 16\n      });\n\n      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={accessToken}', {\n        attribution: '',\n        maxZoom: 18,\n        id: 'mapbox.streets',\n        accessToken: 'pk.eyJ1IjoibWF1bGlkYW4iLCJhIjoiY2puZmpwNWp1MDFqazN3bG1qeThxZzYyOCJ9.BrIt05DvcEYSSirmLlsynQ'\n      }).addTo(myMap);\n\n      myMap.scrollWheelZoom.disable();\n      fillBreadcrumb();\n      DBHelper.mapMarkerForRestaurant(self.restaurant);\n    }\n  });\n};\n\n/**\n * Get current restaurant from page URL.\n */\nconst fetchRestaurantFromURL = (callback) => {\n  if (self.restaurant) { // restaurant already fetched!\n    callback(null, self.restaurant);\n    return;\n  }\n  const id = getParameterByName('id');\n  if (!id) { // no id found in URL\n    error = 'No restaurant id in URL';\n    callback(error, null);\n  } else {\n    DBHelper.fetchRestaurantById(id, (error, restaurant) => {\n      self.restaurant = restaurant;\n      if (!restaurant) {\n        console.error(error);\n        return;\n      }\n      fillRestaurantHTML();\n      callback(null, restaurant);\n    });\n  }\n};\n\n/**\n * Create restaurant HTML and add it to the webpage\n */\nconst fillRestaurantHTML = (restaurant = self.restaurant) => {\n  const name = document.getElementById('restaurant-name');\n  name.innerHTML = restaurant.name;\n\n  const cuisine = document.getElementById('restaurant-cuisine');\n  cuisine.innerHTML = restaurant.cuisine_type;\n\n  const address = document.getElementById('restaurant-address');\n  address.innerHTML = restaurant.address;\n\n  const image = document.getElementById('restaurant-img');\n  image.className = 'restaurant-img';\n  if (restaurant.photograph === undefined) {\n    image.src = '/img/nophoto.jpg';\n  } else {\n    image.src = '/img/' + restaurant.photograph + '-400.jpg';\n  }\n  image.alt = 'Image of the ' + restaurant.name + ' Restaurant';\n\n  const picture = document.getElementById('restaurant-img-media');\n  picture.media = '(min-width: 450px)';\n  if (restaurant.photograph === undefined) {\n    picture.srcset = '/img/nophoto.jpg';\n  } else {\n    picture.srcset = '/img/' + restaurant.photograph + '.jpg';\n  }\n\n  // fill operating hours\n  if (restaurant.operating_hours) {\n    fillRestaurantHoursHTML();\n  }\n\n  // fetch and fill reviews\n  fetchReviews();\n};\n\n/**\n * Create restaurant operating hours HTML table and add it to the webpage.\n */\nconst fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {\n  const hours = document.getElementById('restaurant-hours');\n  for (let key in operatingHours) {\n    const row = document.createElement('tr');\n    const day = document.createElement('td');\n    day.innerHTML = key;\n    row.appendChild(day);\n\n    const time = document.createElement('td');\n    time.innerHTML = operatingHours[key];\n    row.appendChild(time);\n    hours.appendChild(row);\n  }\n};\n\n/**\n * Get reviews\n */\nconst fetchReviews = (callback) => {\n  const id = getParameterByName('id');\n  if (!id) { // no id found in URL\n    error = 'No restaurant id in URL';\n    callback(error, null);\n  } else {\n    DBHelper.fetchReviewsById(restaurant.id, (error, reviews) => {\n      self.reviews = reviews;\n      if (!reviews) {\n        console.error(error);\n        return;\n      }\n      fillReviewsHTML();\n    });\n  }\n};\n\n/**\n * Add Review form submission\n */\nconst addReview = () => {\n  event.preventDefault();\n\n  const id = getParameterByName('id');\n  const name = document.getElementById('review-name');\n  const rating = document.querySelector('#rating option:checked');\n  const comments = document.getElementById('review-comments');\n  let reviewData = {};\n\n  // reset errors\n  name.style.borderColor = '';\n  comments.style.borderColor = '';\n\n  // restaurant id\n  reviewData.restaurant_id = parseInt(id);\n\n  //  name\n  const namePattern = /^[A-Za-z0-9'`-\\s]+$/i;\n  if (!namePattern.test(name.value)) {\n    name.style.borderColor = 'red';\n  } else {\n    reviewData.name = name.value;\n  }\n\n  // date\n  //reviewData.createdAt = new Date().toLocaleString();\n  reviewData.createdAt = new Date().valueOf();\n  // rating\n  reviewData.rating = parseInt(rating.value);\n\n  // comments\n  const commentsPattern = /^[^>]+$/i;\n  if (!commentsPattern.test(comments.value)) {\n    comments.style.borderColor = 'red';\n  } else {\n    reviewData.comments = comments.value;\n  }\n\n  // check if all inputs added\n  if (Object.keys(reviewData).length === 5) {\n    document.getElementById('review-form').reset();\n    DBHelper.sendReview(reviewData);\n\n    const container = document.getElementById('reviews-container');\n    const ul = document.getElementById('reviews-list');\n    ul.appendChild(createReviewHTML(reviewData, true));\n    container.appendChild(ul);\n  }\n  console.log(reviewData);\n};\n\n/**\n * Create all reviews HTML and add them to the webpage.\n */\nconst fillReviewsHTML = (reviews = self.reviews) => {\n  const container = document.getElementById('reviews-container');\n  const title = document.createElement('h2');\n  title.innerHTML = 'Reviews';\n  title.tabIndex = '0';\n  container.appendChild(title);\n\n  if (!reviews) {\n    const noReviews = document.createElement('p');\n    noReviews.innerHTML = 'No reviews yet!';\n    container.appendChild(noReviews);\n    return;\n  }\n\n  if (Object.keys(reviews).length === 0) {\n    const noReviews = document.createElement('p');\n    noReviews.innerHTML = 'Offline mode! No cached reviews for this restaurant.';\n    container.appendChild(noReviews);\n  }\n\n  const ul = document.getElementById('reviews-list');\n  reviews.forEach(review => {\n    ul.appendChild(createReviewHTML(review));\n  });\n\n  // if offline check reviews in localstore\n  if (!navigator.onLine && localStorage.length !== 0) {\n    const id = getParameterByName('id');\n\n    for (var key in localStorage) {\n      if (localStorage.hasOwnProperty(key)) {\n        if (localStorage[key] !== null && key.startsWith('reviewOffline')) {\n          let reviewLocal = JSON.parse(localStorage.getItem(key));\n\n          // check if restaurant id same as review in localstorage\n          if (id === reviewLocal.restaurant_id) {\n            ul.appendChild(createReviewHTML(reviewLocal, true));\n          }\n        }\n      }\n    }\n  }\n  container.appendChild(ul);\n};\n\n/**\n * Create review HTML and add it to the webpage.\n */\nconst createReviewHTML = (review, offline) => {\n  const li = document.createElement('li');\n\n  if (!navigator.onLine && offline) {\n    const offline = document.createElement('div');\n    offline.className = 'reviews-offline';\n    offline.innerHTML = 'OFFLINE';\n    li.appendChild(offline);\n  }\n\n  const name = document.createElement('p');\n  name.innerHTML = review.name;\n  li.appendChild(name);\n\n  const date = document.createElement('p');\n  //date.innerHTML = new Date(review.createdAt).toLocaleString();\n  date.innerHTML = new Date(review.createdAt);\n  li.appendChild(date);\n\n  const rating = document.createElement('p');\n  let stars = '★'.repeat(review.rating);\n  rating.className = 'reviews-list__stars';\n  rating.innerHTML = stars;\n  li.appendChild(rating);\n\n  const comments = document.createElement('p');\n  comments.innerHTML = review.comments;\n  li.appendChild(comments);\n\n  li.tabIndex = '0';\n  return li;\n};\n\n/**\n * Add restaurant name to the breadcrumb navigation menu\n */\nconst fillBreadcrumb = (restaurant = self.restaurant) => {\n  const breadcrumb = document.getElementById('breadcrumb');\n\n  const ul = document.createElement('ul');\n\n  const home = document.createElement('li');\n  const link = document.createElement('a');\n  link.innerHTML = 'Home';\n  link.href = '/';\n  home.appendChild(link);\n  ul.appendChild(home);\n\n  const name = document.createElement('li');\n  name.innerHTML = restaurant.name;\n  ul.appendChild(name);\n  breadcrumb.appendChild(ul);\n};\n\n/**\n * Get a parameter by name from page URL.\n */\nconst getParameterByName = (name, url) => {\n  if (!url) url = window.location.href;\n  name = name.replace(/[[\\]]/g, '\\\\$&');\n  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`);\n  const results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return '';\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n};\n"]}